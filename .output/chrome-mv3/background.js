var background=(function(){"use strict";function _(r){return r==null||typeof r=="function"?{main:r}:r}const j=r=>Array.isArray(r)?r.map(e=>{if(!e||typeof e!="object")return null;const a=e;if(!a.id||!a.name||!Array.isArray(a.fields))return null;const b=a.fields.map(v=>{if(!v||typeof v!="object")return null;const l=v;return!l.id||!l.name||!l.selector||!l.xpath||!l.mode||!l.source?null:{id:l.id,name:l.name,selector:l.selector,xpath:l.xpath,mode:l.mode,source:l.source,attrName:l.attrName??void 0,regex:typeof l.regex=="string"?l.regex:void 0,regexFlags:typeof l.regexFlags=="string"?l.regexFlags:void 0}}).filter(v=>!!v);return{id:a.id,name:a.name,fields:b,createdAt:a.createdAt??Date.now(),updatedAt:a.updatedAt??Date.now()}}).filter(e=>!!e):[],U=r=>{var a;if(!r||typeof r!="object")return{name:"",fields:[],isPicking:!1};const e=r;return{name:typeof e.name=="string"?e.name:"",fields:((a=j([{id:"draft",name:"draft",fields:e.fields??[]}])[0])==null?void 0:a.fields)??[],isPicking:!!e.isPicking}},D="xcalibr_state",u={version:1,isOpen:!1,isWide:!1,isVisible:!0,searchQuery:"",tabOffsetY:0,showMenuBar:!1,isAnchored:!1,menuBarActiveMenu:null,menuBarActiveSubmenu:null,scrapers:[],scraperDraft:{name:"",fields:[],isPicking:!1},scraperBuilderOpen:!1,scraperRunnerOpen:!1,scraperRunnerId:null,scraperRunnerResults:null,scraperRunnerError:null,quickBarToolIds:[],toolWindows:{},toolData:{}},I=r=>{if(!r||typeof r!="object")return{...u};const e=r,a=typeof e.tabOffsetY=="number"?e.tabOffsetY:u.tabOffsetY,b=typeof e.isAnchored=="boolean"?e.isAnchored:u.isAnchored,v=typeof e.menuBarActiveMenu=="string"||e.menuBarActiveMenu===null?e.menuBarActiveMenu:u.menuBarActiveMenu,l=typeof e.menuBarActiveSubmenu=="string"||e.menuBarActiveSubmenu===null?e.menuBarActiveSubmenu:u.menuBarActiveSubmenu,C=j(e.scrapers),B=U(e.scraperDraft),p=typeof e.scraperBuilderOpen=="boolean"?e.scraperBuilderOpen:u.scraperBuilderOpen,t=typeof e.scraperRunnerOpen=="boolean"?e.scraperRunnerOpen:u.scraperRunnerOpen,g=typeof e.scraperRunnerId=="string"||e.scraperRunnerId===null?e.scraperRunnerId:u.scraperRunnerId,h=e.scraperRunnerResults&&typeof e.scraperRunnerResults=="object"?e.scraperRunnerResults:u.scraperRunnerResults,y=typeof e.scraperRunnerError=="string"||e.scraperRunnerError===null?e.scraperRunnerError:u.scraperRunnerError,d=Array.isArray(e.quickBarToolIds)?e.quickBarToolIds.filter(R=>typeof R=="string"):u.quickBarToolIds,f=e.toolWindows&&typeof e.toolWindows=="object"?e.toolWindows:u.toolWindows,T=e.toolData&&typeof e.toolData=="object"?e.toolData:u.toolData;return{...u,...e,tabOffsetY:a,isAnchored:b,menuBarActiveMenu:v,menuBarActiveSubmenu:l,scrapers:C,scraperDraft:B,scraperBuilderOpen:p,scraperRunnerOpen:t,scraperRunnerId:g,scraperRunnerResults:h,scraperRunnerError:y,quickBarToolIds:d,toolWindows:f,toolData:T,version:u.version}},z=async()=>{const r=await chrome.storage.local.get(D);return I(r[D])},Y=async r=>{const e=await z(),a=typeof r=="function"?r(e):{...e,...r},b=I(a);return await chrome.storage.local.set({[D]:b}),b},G=_(()=>{chrome.commands.onCommand.addListener(async r=>{r==="toggle-xcalibr-visibility"&&await Y(e=>({...e,isVisible:!e.isVisible}))}),chrome.runtime.onMessage.addListener((r,e,a)=>{if((r==null?void 0:r.type)==="xcalibr-fetch-robots")return(async()=>{var T;const t=(T=e.tab)==null?void 0:T.id;if(typeof t!="number"){a({error:"No active tab available."});return}const h=(await chrome.tabs.get(t)).url;if(!h){a({error:"Unable to resolve tab URL."});return}const y=new URL(h).origin,f=await(await fetch(`${y}/robots.txt`,{redirect:"follow"})).text();a({url:`${y}/robots.txt`,content:f,updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"Failed to fetch robots.txt."})}),!0;if((r==null?void 0:r.type)==="xcalibr-fetch-headers")return(async()=>{var f;const t=(f=e.tab)==null?void 0:f.id;if(typeof t!="number"){a({error:"No active tab available."});return}const h=(await chrome.tabs.get(t)).url;if(!h){a({error:"Unable to resolve tab URL."});return}const y=await fetch(h,{redirect:"follow"}),d=Array.from(y.headers.entries()).map(([T,R])=>({name:T,value:R}));a({url:h,status:y.status,headers:d,updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"Failed to fetch headers."})}),!0;if((r==null?void 0:r.type)==="xcalibr-payload-replay")return(async()=>{const t=r.payload,g=await fetch(t.url,{method:t.method,headers:Object.fromEntries(t.headers.map(d=>[d.name,d.value])),body:t.method==="GET"||t.method==="HEAD"?void 0:t.body}),h=await g.text(),y=Array.from(g.headers.entries()).map(([d,f])=>({name:d,value:f}));a({responseStatus:g.status,responseHeaders:y,responseBody:h,error:void 0})})().catch(t=>{a({error:t instanceof Error?t.message:"Request failed."})}),!0;if((r==null?void 0:r.type)==="xcalibr-cors-check")return(async()=>{const{url:t}=r.payload,g=await fetch(t,{method:"GET"});a({result:{status:g.status,acao:g.headers.get("access-control-allow-origin"),acc:g.headers.get("access-control-allow-credentials"),methods:g.headers.get("access-control-allow-methods"),headers:g.headers.get("access-control-allow-headers")},updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"CORS check failed."})}),!0;if((r==null?void 0:r.type)!=="xcalibr-inject-code")return;const{mode:b,scope:v,code:l}=r.payload,C=async p=>{if(b==="css"){await chrome.scripting.insertCSS({target:{tabId:p},css:l});return}await chrome.scripting.executeScript({target:{tabId:p},func:t=>{const g=document.createElement("script");g.textContent=t,(document.head||document.documentElement).appendChild(g),g.remove()},args:[l]})};return(async()=>{var t;if(v==="current"){const g=(t=e.tab)==null?void 0:t.id;typeof g=="number"&&await C(g),a({ok:!0});return}const p=await chrome.tabs.query({});await Promise.allSettled(p.map(g=>g.id).filter(g=>typeof g=="number").map(g=>C(g))),a({ok:!0})})().catch(()=>a({ok:!1})),!0})});function J(){}var M={exports:{}},V=M.exports,L;function H(){return L||(L=1,(function(r,e){(function(a,b){b(r)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:V,function(a){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)a.exports=globalThis.browser;else{const b="The message port closed before a response was received.",v=l=>{const C={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(C).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class B extends WeakMap{constructor(n,i=void 0){super(i),this.createItem=n}get(n){return this.has(n)||this.set(n,this.createItem(n)),super.get(n)}}const p=s=>s&&typeof s=="object"&&typeof s.then=="function",t=(s,n)=>(...i)=>{l.runtime.lastError?s.reject(new Error(l.runtime.lastError.message)):n.singleCallbackArg||i.length<=1&&n.singleCallbackArg!==!1?s.resolve(i[0]):s.resolve(i)},g=s=>s==1?"argument":"arguments",h=(s,n)=>function(c,...A){if(A.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${g(n.minArgs)} for ${s}(), got ${A.length}`);if(A.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${g(n.maxArgs)} for ${s}(), got ${A.length}`);return new Promise((x,w)=>{if(n.fallbackToNoCallback)try{c[s](...A,t({resolve:x,reject:w},n))}catch(o){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,o),c[s](...A),n.fallbackToNoCallback=!1,n.noCallback=!0,x()}else n.noCallback?(c[s](...A),x()):c[s](...A,t({resolve:x,reject:w},n))})},y=(s,n,i)=>new Proxy(n,{apply(c,A,x){return i.call(A,s,...x)}});let d=Function.call.bind(Object.prototype.hasOwnProperty);const f=(s,n={},i={})=>{let c=Object.create(null),A={has(w,o){return o in s||o in c},get(w,o,k){if(o in c)return c[o];if(!(o in s))return;let m=s[o];if(typeof m=="function")if(typeof n[o]=="function")m=y(s,s[o],n[o]);else if(d(i,o)){let S=h(o,i[o]);m=y(s,s[o],S)}else m=m.bind(s);else if(typeof m=="object"&&m!==null&&(d(n,o)||d(i,o)))m=f(m,n[o],i[o]);else if(d(i,"*"))m=f(m,n[o],i["*"]);else return Object.defineProperty(c,o,{configurable:!0,enumerable:!0,get(){return s[o]},set(S){s[o]=S}}),m;return c[o]=m,m},set(w,o,k,m){return o in c?c[o]=k:s[o]=k,!0},defineProperty(w,o,k){return Reflect.defineProperty(c,o,k)},deleteProperty(w,o){return Reflect.deleteProperty(c,o)}},x=Object.create(s);return new Proxy(x,A)},T=s=>({addListener(n,i,...c){n.addListener(s.get(i),...c)},hasListener(n,i){return n.hasListener(s.get(i))},removeListener(n,i){n.removeListener(s.get(i))}}),R=new B(s=>typeof s!="function"?s:function(i){const c=f(i,{},{getContent:{minArgs:0,maxArgs:0}});s(c)}),q=new B(s=>typeof s!="function"?s:function(i,c,A){let x=!1,w,o=new Promise(P=>{w=function(E){x=!0,P(E)}}),k;try{k=s(i,c,w)}catch(P){k=Promise.reject(P)}const m=k!==!0&&p(k);if(k!==!0&&!m&&!x)return!1;const S=P=>{P.then(E=>{A(E)},E=>{let $;E&&(E instanceof Error||typeof E.message=="string")?$=E.message:$="An unexpected error occurred",A({__mozWebExtensionPolyfillReject__:!0,message:$})}).catch(E=>{console.error("Failed to send onMessage rejected reply",E)})};return S(m?k:o),!0}),K=({reject:s,resolve:n},i)=>{l.runtime.lastError?l.runtime.lastError.message===b?n():s(new Error(l.runtime.lastError.message)):i&&i.__mozWebExtensionPolyfillReject__?s(new Error(i.message)):n(i)},W=(s,n,i,...c)=>{if(c.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${g(n.minArgs)} for ${s}(), got ${c.length}`);if(c.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${g(n.maxArgs)} for ${s}(), got ${c.length}`);return new Promise((A,x)=>{const w=K.bind(null,{resolve:A,reject:x});c.push(w),i.sendMessage(...c)})},Q={devtools:{network:{onRequestFinished:T(R)}},runtime:{onMessage:T(q),onMessageExternal:T(q),sendMessage:W.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:W.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},N={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return C.privacy={network:{"*":N},services:{"*":N},websites:{"*":N}},f(l,Q,C)};a.exports=v(chrome)}})})(M)),M.exports}H();function O(r,...e){}const Z={debug:(...r)=>O(console.debug,...r),log:(...r)=>O(console.log,...r),warn:(...r)=>O(console.warn,...r),error:(...r)=>O(console.error,...r)};let F;try{F=G.main(),F instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw Z.error("The background crashed on startup!"),r}return F})();
background;
