var background=(function(){"use strict";function _(r){return r==null||typeof r=="function"?{main:r}:r}const j=r=>Array.isArray(r)?r.map(e=>{if(!e||typeof e!="object")return null;const a=e;if(!a.id||!a.name||!Array.isArray(a.fields))return null;const y=a.fields.map(v=>{if(!v||typeof v!="object")return null;const l=v;return!l.id||!l.name||!l.selector||!l.xpath||!l.mode||!l.source?null:{id:l.id,name:l.name,selector:l.selector,xpath:l.xpath,mode:l.mode,source:l.source,attrName:l.attrName,regex:typeof l.regex=="string"?l.regex:void 0,regexFlags:typeof l.regexFlags=="string"?l.regexFlags:void 0}}).filter(v=>v!==null);return{id:a.id,name:a.name,fields:y,createdAt:a.createdAt??Date.now(),updatedAt:a.updatedAt??Date.now()}}).filter(e=>e!==null):[],U=r=>{var a;if(!r||typeof r!="object")return{name:"",fields:[],isPicking:!1};const e=r;return{name:typeof e.name=="string"?e.name:"",fields:((a=j([{id:"draft",name:"draft",fields:e.fields??[]}])[0])==null?void 0:a.fields)??[],isPicking:!!e.isPicking}},O="xcalibr_state",d={version:1,isOpen:!1,isWide:!1,isVisible:!0,searchQuery:"",tabOffsetY:0,showMenuBar:!1,isAnchored:!1,menuBarActiveMenu:null,menuBarActiveSubmenu:null,scrapers:[],scraperDraft:{name:"",fields:[],isPicking:!1},scraperBuilderOpen:!1,scraperRunnerOpen:!1,scraperRunnerId:null,scraperRunnerResults:null,scraperRunnerError:null,quickBarToolIds:[],toolWindows:{},toolData:{}},I=r=>{if(!r||typeof r!="object")return{...d};const e=r,a=typeof e.tabOffsetY=="number"?e.tabOffsetY:d.tabOffsetY,y=typeof e.isAnchored=="boolean"?e.isAnchored:d.isAnchored,v=typeof e.menuBarActiveMenu=="string"||e.menuBarActiveMenu===null?e.menuBarActiveMenu:d.menuBarActiveMenu,l=typeof e.menuBarActiveSubmenu=="string"||e.menuBarActiveSubmenu===null?e.menuBarActiveSubmenu:d.menuBarActiveSubmenu,S=j(e.scrapers),f=U(e.scraperDraft),t=typeof e.scraperBuilderOpen=="boolean"?e.scraperBuilderOpen:d.scraperBuilderOpen,i=typeof e.scraperRunnerOpen=="boolean"?e.scraperRunnerOpen:d.scraperRunnerOpen,m=typeof e.scraperRunnerId=="string"||e.scraperRunnerId===null?e.scraperRunnerId:d.scraperRunnerId,b=e.scraperRunnerResults&&typeof e.scraperRunnerResults=="object"?e.scraperRunnerResults:d.scraperRunnerResults,x=typeof e.scraperRunnerError=="string"||e.scraperRunnerError===null?e.scraperRunnerError:d.scraperRunnerError,h=Array.isArray(e.quickBarToolIds)?e.quickBarToolIds.filter(F=>typeof F=="string"):d.quickBarToolIds,T=e.toolWindows&&typeof e.toolWindows=="object"?e.toolWindows:d.toolWindows,C=e.toolData&&typeof e.toolData=="object"?e.toolData:d.toolData;return{...d,...e,tabOffsetY:a,isAnchored:y,menuBarActiveMenu:v,menuBarActiveSubmenu:l,scrapers:S,scraperDraft:f,scraperBuilderOpen:t,scraperRunnerOpen:i,scraperRunnerId:m,scraperRunnerResults:b,scraperRunnerError:x,quickBarToolIds:h,toolWindows:T,toolData:C,version:d.version}},z=async()=>{const r=await chrome.storage.local.get(O);return I(r[O])},G=async r=>{const e=await z(),a=typeof r=="function"?r(e):{...e,...r},y=I(a);return await chrome.storage.local.set({[O]:y}),y},Y=_(()=>{chrome.commands.onCommand.addListener(async r=>{r==="toggle-xcalibr-visibility"&&await G(e=>({...e,isVisible:!e.isVisible}))}),chrome.runtime.onMessage.addListener((r,e,a)=>{if((r==null?void 0:r.type)==="xcalibr-fetch-robots")return(async()=>{var T;const t=(T=e.tab)==null?void 0:T.id;if(typeof t!="number"){a({error:"No active tab available."});return}const m=(await chrome.tabs.get(t)).url;if(!m){a({error:"Unable to resolve tab URL."});return}const b=new URL(m).origin,h=await(await fetch(`${b}/robots.txt`,{redirect:"follow"})).text();a({url:`${b}/robots.txt`,content:h,updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"Failed to fetch robots.txt."})}),!0;if((r==null?void 0:r.type)==="xcalibr-fetch-headers")return(async()=>{var h;const t=(h=e.tab)==null?void 0:h.id;if(typeof t!="number"){a({error:"No active tab available."});return}const m=(await chrome.tabs.get(t)).url;if(!m){a({error:"Unable to resolve tab URL."});return}const b=await fetch(m,{redirect:"follow"}),x=Array.from(b.headers.entries()).map(([T,C])=>({name:T,value:C}));a({url:m,status:b.status,headers:x,updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"Failed to fetch headers."})}),!0;if((r==null?void 0:r.type)==="xcalibr-payload-replay")return(async()=>{const t=r.payload,i=await fetch(t.url,{method:t.method,headers:Object.fromEntries(t.headers.map(x=>[x.name,x.value])),body:t.method==="GET"||t.method==="HEAD"?void 0:t.body}),m=await i.text(),b=Array.from(i.headers.entries()).map(([x,h])=>({name:x,value:h}));a({responseStatus:i.status,responseHeaders:b,responseBody:m,error:void 0})})().catch(t=>{a({error:t instanceof Error?t.message:"Request failed."})}),!0;if((r==null?void 0:r.type)==="xcalibr-cors-check")return(async()=>{const{url:t}=r.payload,i=await fetch(t,{method:"GET"});a({result:{status:i.status,acao:i.headers.get("access-control-allow-origin"),acc:i.headers.get("access-control-allow-credentials"),methods:i.headers.get("access-control-allow-methods"),headers:i.headers.get("access-control-allow-headers")},updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"CORS check failed."})}),!0;if((r==null?void 0:r.type)==="xcalibr-couchdb-fetch")return(async()=>{const{url:t}=r.payload,i=await fetch(t,{method:"GET"}),m=await i.text();a({output:m,error:i.ok?"":`Request failed (${i.status})`})})().catch(t=>{a({output:"",error:t instanceof Error?t.message:"Fetch failed."})}),!0;if((r==null?void 0:r.type)==="xcalibr-http-request")return(async()=>{const t=r.payload,i=await fetch(t.url,{method:t.method,headers:t.headers,body:t.method==="GET"||t.method==="HEAD"?void 0:t.body}),m=await i.text();a({status:i.status,statusText:i.statusText,headers:Array.from(i.headers.entries()).map(([b,x])=>({name:b,value:x})),body:m})})().catch(t=>{a({status:0,statusText:"",headers:[],body:"",error:t instanceof Error?t.message:"Request failed."})}),!0;if((r==null?void 0:r.type)!=="xcalibr-inject-code")return;const{scope:y,code:v}=r.payload,l=async f=>{await chrome.scripting.insertCSS({target:{tabId:f},css:v})};return(async()=>{var t;if(y==="current"){const i=(t=e.tab)==null?void 0:t.id;typeof i=="number"&&await l(i),a({ok:!0});return}const f=await chrome.tabs.query({});await Promise.allSettled(f.map(i=>i.id).filter(i=>typeof i=="number").map(i=>l(i))),a({ok:!0})})().catch(()=>a({ok:!1})),!0})});function J(){}var P={exports:{}},H=P.exports,q;function V(){return q||(q=1,(function(r,e){(function(a,y){y(r)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:H,function(a){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)a.exports=globalThis.browser;else{const y="The message port closed before a response was received.",v=l=>{const S={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(S).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class f extends WeakMap{constructor(n,g=void 0){super(g),this.createItem=n}get(n){return this.has(n)||this.set(n,this.createItem(n)),super.get(n)}}const t=s=>s&&typeof s=="object"&&typeof s.then=="function",i=(s,n)=>(...g)=>{l.runtime.lastError?s.reject(new Error(l.runtime.lastError.message)):n.singleCallbackArg||g.length<=1&&n.singleCallbackArg!==!1?s.resolve(g[0]):s.resolve(g)},m=s=>s==1?"argument":"arguments",b=(s,n)=>function(c,...u){if(u.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${m(n.minArgs)} for ${s}(), got ${u.length}`);if(u.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${m(n.maxArgs)} for ${s}(), got ${u.length}`);return new Promise((p,w)=>{if(n.fallbackToNoCallback)try{c[s](...u,i({resolve:p,reject:w},n))}catch(o){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,o),c[s](...u),n.fallbackToNoCallback=!1,n.noCallback=!0,p()}else n.noCallback?(c[s](...u),p()):c[s](...u,i({resolve:p,reject:w},n))})},x=(s,n,g)=>new Proxy(n,{apply(c,u,p){return g.call(u,s,...p)}});let h=Function.call.bind(Object.prototype.hasOwnProperty);const T=(s,n={},g={})=>{let c=Object.create(null),u={has(w,o){return o in s||o in c},get(w,o,k){if(o in c)return c[o];if(!(o in s))return;let A=s[o];if(typeof A=="function")if(typeof n[o]=="function")A=x(s,s[o],n[o]);else if(h(g,o)){let B=b(o,g[o]);A=x(s,s[o],B)}else A=A.bind(s);else if(typeof A=="object"&&A!==null&&(h(n,o)||h(g,o)))A=T(A,n[o],g[o]);else if(h(g,"*"))A=T(A,n[o],g["*"]);else return Object.defineProperty(c,o,{configurable:!0,enumerable:!0,get(){return s[o]},set(B){s[o]=B}}),A;return c[o]=A,A},set(w,o,k,A){return o in c?c[o]=k:s[o]=k,!0},defineProperty(w,o,k){return Reflect.defineProperty(c,o,k)},deleteProperty(w,o){return Reflect.deleteProperty(c,o)}},p=Object.create(s);return new Proxy(p,u)},C=s=>({addListener(n,g,...c){n.addListener(s.get(g),...c)},hasListener(n,g){return n.hasListener(s.get(g))},removeListener(n,g){n.removeListener(s.get(g))}}),F=new f(s=>typeof s!="function"?s:function(g){const c=T(g,{},{getContent:{minArgs:0,maxArgs:0}});s(c)}),L=new f(s=>typeof s!="function"?s:function(g,c,u){let p=!1,w,o=new Promise(R=>{w=function(E){p=!0,R(E)}}),k;try{k=s(g,c,w)}catch(R){k=Promise.reject(R)}const A=k!==!0&&t(k);if(k!==!0&&!A&&!p)return!1;const B=R=>{R.then(E=>{u(E)},E=>{let N;E&&(E instanceof Error||typeof E.message=="string")?N=E.message:N="An unexpected error occurred",u({__mozWebExtensionPolyfillReject__:!0,message:N})}).catch(E=>{console.error("Failed to send onMessage rejected reply",E)})};return B(A?k:o),!0}),K=({reject:s,resolve:n},g)=>{l.runtime.lastError?l.runtime.lastError.message===y?n():s(new Error(l.runtime.lastError.message)):g&&g.__mozWebExtensionPolyfillReject__?s(new Error(g.message)):n(g)},W=(s,n,g,...c)=>{if(c.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${m(n.minArgs)} for ${s}(), got ${c.length}`);if(c.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${m(n.maxArgs)} for ${s}(), got ${c.length}`);return new Promise((u,p)=>{const w=K.bind(null,{resolve:u,reject:p});c.push(w),g.sendMessage(...c)})},Q={devtools:{network:{onRequestFinished:C(F)}},runtime:{onMessage:C(L),onMessageExternal:C(L),sendMessage:W.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:W.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},$={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return S.privacy={network:{"*":$},services:{"*":$},websites:{"*":$}},T(l,Q,S)};a.exports=v(chrome)}})})(P)),P.exports}V();function M(r,...e){}const Z={debug:(...r)=>M(console.debug,...r),log:(...r)=>M(console.log,...r),warn:(...r)=>M(console.warn,...r),error:(...r)=>M(console.error,...r)};let D;try{D=Y.main(),D instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw Z.error("The background crashed on startup!"),r}return D})();
background;
