var background=(function(){"use strict";function _(r){return r==null||typeof r=="function"?{main:r}:r}const j=r=>Array.isArray(r)?r.map(e=>{if(!e||typeof e!="object")return null;const o=e;if(!o.id||!o.name||!Array.isArray(o.fields))return null;const y=o.fields.map(v=>{if(!v||typeof v!="object")return null;const g=v;return!g.id||!g.name||!g.selector||!g.xpath||!g.mode||!g.source?null:{id:g.id,name:g.name,selector:g.selector,xpath:g.xpath,mode:g.mode,source:g.source,attrName:g.attrName??void 0,regex:typeof g.regex=="string"?g.regex:void 0,regexFlags:typeof g.regexFlags=="string"?g.regexFlags:void 0}}).filter(v=>!!v);return{id:o.id,name:o.name,fields:y,createdAt:o.createdAt??Date.now(),updatedAt:o.updatedAt??Date.now()}}).filter(e=>!!e):[],U=r=>{var o;if(!r||typeof r!="object")return{name:"",fields:[],isPicking:!1};const e=r;return{name:typeof e.name=="string"?e.name:"",fields:((o=j([{id:"draft",name:"draft",fields:e.fields??[]}])[0])==null?void 0:o.fields)??[],isPicking:!!e.isPicking}},D="xcalibr_state",f={version:1,isOpen:!1,isWide:!1,isVisible:!0,searchQuery:"",tabOffsetY:0,showMenuBar:!1,isAnchored:!1,menuBarActiveMenu:null,menuBarActiveSubmenu:null,scrapers:[],scraperDraft:{name:"",fields:[],isPicking:!1},scraperBuilderOpen:!1,scraperRunnerOpen:!1,scraperRunnerId:null,scraperRunnerResults:null,scraperRunnerError:null,quickBarToolIds:[],toolWindows:{},toolData:{}},q=r=>{if(!r||typeof r!="object")return{...f};const e=r,o=typeof e.tabOffsetY=="number"?e.tabOffsetY:f.tabOffsetY,y=typeof e.isAnchored=="boolean"?e.isAnchored:f.isAnchored,v=typeof e.menuBarActiveMenu=="string"||e.menuBarActiveMenu===null?e.menuBarActiveMenu:f.menuBarActiveMenu,g=typeof e.menuBarActiveSubmenu=="string"||e.menuBarActiveSubmenu===null?e.menuBarActiveSubmenu:f.menuBarActiveSubmenu,C=j(e.scrapers),B=U(e.scraperDraft),x=typeof e.scraperBuilderOpen=="boolean"?e.scraperBuilderOpen:f.scraperBuilderOpen,t=typeof e.scraperRunnerOpen=="boolean"?e.scraperRunnerOpen:f.scraperRunnerOpen,a=typeof e.scraperRunnerId=="string"||e.scraperRunnerId===null?e.scraperRunnerId:f.scraperRunnerId,u=e.scraperRunnerResults&&typeof e.scraperRunnerResults=="object"?e.scraperRunnerResults:f.scraperRunnerResults,b=typeof e.scraperRunnerError=="string"||e.scraperRunnerError===null?e.scraperRunnerError:f.scraperRunnerError,d=Array.isArray(e.quickBarToolIds)?e.quickBarToolIds.filter(R=>typeof R=="string"):f.quickBarToolIds,h=e.toolWindows&&typeof e.toolWindows=="object"?e.toolWindows:f.toolWindows,T=e.toolData&&typeof e.toolData=="object"?e.toolData:f.toolData;return{...f,...e,tabOffsetY:o,isAnchored:y,menuBarActiveMenu:v,menuBarActiveSubmenu:g,scrapers:C,scraperDraft:B,scraperBuilderOpen:x,scraperRunnerOpen:t,scraperRunnerId:a,scraperRunnerResults:u,scraperRunnerError:b,quickBarToolIds:d,toolWindows:h,toolData:T,version:f.version}},z=async()=>{const r=await chrome.storage.local.get(D);return q(r[D])},G=async r=>{const e=await z(),o=typeof r=="function"?r(e):{...e,...r},y=q(o);return await chrome.storage.local.set({[D]:y}),y},Y=_(()=>{chrome.commands.onCommand.addListener(async r=>{r==="toggle-xcalibr-visibility"&&await G(e=>({...e,isVisible:!e.isVisible}))}),chrome.runtime.onMessage.addListener((r,e,o)=>{if((r==null?void 0:r.type)==="xcalibr-fetch-robots")return(async()=>{var T;const t=(T=e.tab)==null?void 0:T.id;if(typeof t!="number"){o({error:"No active tab available."});return}const u=(await chrome.tabs.get(t)).url;if(!u){o({error:"Unable to resolve tab URL."});return}const b=new URL(u).origin,h=await(await fetch(`${b}/robots.txt`,{redirect:"follow"})).text();o({url:`${b}/robots.txt`,content:h,updatedAt:Date.now()})})().catch(t=>{o({error:t instanceof Error?t.message:"Failed to fetch robots.txt."})}),!0;if((r==null?void 0:r.type)==="xcalibr-fetch-headers")return(async()=>{var h;const t=(h=e.tab)==null?void 0:h.id;if(typeof t!="number"){o({error:"No active tab available."});return}const u=(await chrome.tabs.get(t)).url;if(!u){o({error:"Unable to resolve tab URL."});return}const b=await fetch(u,{redirect:"follow"}),d=Array.from(b.headers.entries()).map(([T,R])=>({name:T,value:R}));o({url:u,status:b.status,headers:d,updatedAt:Date.now()})})().catch(t=>{o({error:t instanceof Error?t.message:"Failed to fetch headers."})}),!0;if((r==null?void 0:r.type)==="xcalibr-payload-replay")return(async()=>{const t=r.payload,a=await fetch(t.url,{method:t.method,headers:Object.fromEntries(t.headers.map(d=>[d.name,d.value])),body:t.method==="GET"||t.method==="HEAD"?void 0:t.body}),u=await a.text(),b=Array.from(a.headers.entries()).map(([d,h])=>({name:d,value:h}));o({responseStatus:a.status,responseHeaders:b,responseBody:u,error:void 0})})().catch(t=>{o({error:t instanceof Error?t.message:"Request failed."})}),!0;if((r==null?void 0:r.type)==="xcalibr-cors-check")return(async()=>{const{url:t}=r.payload,a=await fetch(t,{method:"GET"});o({result:{status:a.status,acao:a.headers.get("access-control-allow-origin"),acc:a.headers.get("access-control-allow-credentials"),methods:a.headers.get("access-control-allow-methods"),headers:a.headers.get("access-control-allow-headers")},updatedAt:Date.now()})})().catch(t=>{o({error:t instanceof Error?t.message:"CORS check failed."})}),!0;if((r==null?void 0:r.type)==="xcalibr-couchdb-fetch")return(async()=>{const{url:t}=r.payload,a=await fetch(t,{method:"GET"}),u=await a.text();o({output:u,error:a.ok?"":`Request failed (${a.status})`})})().catch(t=>{o({output:"",error:t instanceof Error?t.message:"Fetch failed."})}),!0;if((r==null?void 0:r.type)==="xcalibr-http-request")return(async()=>{const t=r.payload,a=await fetch(t.url,{method:t.method,headers:t.headers,body:t.method==="GET"||t.method==="HEAD"?void 0:t.body}),u=await a.text();o({status:a.status,statusText:a.statusText,headers:Array.from(a.headers.entries()).map(([b,d])=>({name:b,value:d})),body:u})})().catch(t=>{o({status:0,statusText:"",headers:[],body:"",error:t instanceof Error?t.message:"Request failed."})}),!0;if((r==null?void 0:r.type)!=="xcalibr-inject-code")return;const{mode:y,scope:v,code:g}=r.payload,C=async x=>{if(y==="css"){await chrome.scripting.insertCSS({target:{tabId:x},css:g});return}await chrome.scripting.executeScript({target:{tabId:x},func:t=>{const a=document.createElement("script");a.textContent=t,(document.head||document.documentElement).appendChild(a),a.remove()},args:[g]})};return(async()=>{var t;if(v==="current"){const a=(t=e.tab)==null?void 0:t.id;typeof a=="number"&&await C(a),o({ok:!0});return}const x=await chrome.tabs.query({});await Promise.allSettled(x.map(a=>a.id).filter(a=>typeof a=="number").map(a=>C(a))),o({ok:!0})})().catch(()=>o({ok:!1})),!0})});function J(){}var M={exports:{}},H=M.exports,I;function V(){return I||(I=1,(function(r,e){(function(o,y){y(r)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:H,function(o){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)o.exports=globalThis.browser;else{const y="The message port closed before a response was received.",v=g=>{const C={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(C).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class B extends WeakMap{constructor(n,c=void 0){super(c),this.createItem=n}get(n){return this.has(n)||this.set(n,this.createItem(n)),super.get(n)}}const x=s=>s&&typeof s=="object"&&typeof s.then=="function",t=(s,n)=>(...c)=>{g.runtime.lastError?s.reject(new Error(g.runtime.lastError.message)):n.singleCallbackArg||c.length<=1&&n.singleCallbackArg!==!1?s.resolve(c[0]):s.resolve(c)},a=s=>s==1?"argument":"arguments",u=(s,n)=>function(l,...A){if(A.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${a(n.minArgs)} for ${s}(), got ${A.length}`);if(A.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${a(n.maxArgs)} for ${s}(), got ${A.length}`);return new Promise((p,w)=>{if(n.fallbackToNoCallback)try{l[s](...A,t({resolve:p,reject:w},n))}catch(i){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),l[s](...A),n.fallbackToNoCallback=!1,n.noCallback=!0,p()}else n.noCallback?(l[s](...A),p()):l[s](...A,t({resolve:p,reject:w},n))})},b=(s,n,c)=>new Proxy(n,{apply(l,A,p){return c.call(A,s,...p)}});let d=Function.call.bind(Object.prototype.hasOwnProperty);const h=(s,n={},c={})=>{let l=Object.create(null),A={has(w,i){return i in s||i in l},get(w,i,k){if(i in l)return l[i];if(!(i in s))return;let m=s[i];if(typeof m=="function")if(typeof n[i]=="function")m=b(s,s[i],n[i]);else if(d(c,i)){let S=u(i,c[i]);m=b(s,s[i],S)}else m=m.bind(s);else if(typeof m=="object"&&m!==null&&(d(n,i)||d(c,i)))m=h(m,n[i],c[i]);else if(d(c,"*"))m=h(m,n[i],c["*"]);else return Object.defineProperty(l,i,{configurable:!0,enumerable:!0,get(){return s[i]},set(S){s[i]=S}}),m;return l[i]=m,m},set(w,i,k,m){return i in l?l[i]=k:s[i]=k,!0},defineProperty(w,i,k){return Reflect.defineProperty(l,i,k)},deleteProperty(w,i){return Reflect.deleteProperty(l,i)}},p=Object.create(s);return new Proxy(p,A)},T=s=>({addListener(n,c,...l){n.addListener(s.get(c),...l)},hasListener(n,c){return n.hasListener(s.get(c))},removeListener(n,c){n.removeListener(s.get(c))}}),R=new B(s=>typeof s!="function"?s:function(c){const l=h(c,{},{getContent:{minArgs:0,maxArgs:0}});s(l)}),L=new B(s=>typeof s!="function"?s:function(c,l,A){let p=!1,w,i=new Promise(P=>{w=function(E){p=!0,P(E)}}),k;try{k=s(c,l,w)}catch(P){k=Promise.reject(P)}const m=k!==!0&&x(k);if(k!==!0&&!m&&!p)return!1;const S=P=>{P.then(E=>{A(E)},E=>{let N;E&&(E instanceof Error||typeof E.message=="string")?N=E.message:N="An unexpected error occurred",A({__mozWebExtensionPolyfillReject__:!0,message:N})}).catch(E=>{console.error("Failed to send onMessage rejected reply",E)})};return S(m?k:i),!0}),K=({reject:s,resolve:n},c)=>{g.runtime.lastError?g.runtime.lastError.message===y?n():s(new Error(g.runtime.lastError.message)):c&&c.__mozWebExtensionPolyfillReject__?s(new Error(c.message)):n(c)},W=(s,n,c,...l)=>{if(l.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${a(n.minArgs)} for ${s}(), got ${l.length}`);if(l.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${a(n.maxArgs)} for ${s}(), got ${l.length}`);return new Promise((A,p)=>{const w=K.bind(null,{resolve:A,reject:p});l.push(w),c.sendMessage(...l)})},Q={devtools:{network:{onRequestFinished:T(R)}},runtime:{onMessage:T(L),onMessageExternal:T(L),sendMessage:W.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:W.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},$={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return C.privacy={network:{"*":$},services:{"*":$},websites:{"*":$}},h(g,Q,C)};o.exports=v(chrome)}})})(M)),M.exports}V();function O(r,...e){}const Z={debug:(...r)=>O(console.debug,...r),log:(...r)=>O(console.log,...r),warn:(...r)=>O(console.warn,...r),error:(...r)=>O(console.error,...r)};let F;try{F=Y.main(),F instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw Z.error("The background crashed on startup!"),r}return F})();
background;
