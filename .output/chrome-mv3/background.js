var background=(function(){"use strict";function _(e){return e==null||typeof e=="function"?{main:e}:e}const I=e=>Array.isArray(e)?e.map(r=>{if(!r||typeof r!="object")return null;const a=r;if(!a.id||!a.name||!Array.isArray(a.fields))return null;const b=a.fields.map(v=>{if(!v||typeof v!="object")return null;const c=v;return!c.id||!c.name||!c.selector||!c.xpath||!c.mode||!c.source?null:{id:c.id,name:c.name,selector:c.selector,xpath:c.xpath,mode:c.mode,source:c.source,attrName:c.attrName??void 0}}).filter(v=>!!v);return{id:a.id,name:a.name,fields:b,createdAt:a.createdAt??Date.now(),updatedAt:a.updatedAt??Date.now()}}).filter(r=>!!r):[],U=e=>{var a;if(!e||typeof e!="object")return{name:"",fields:[],isPicking:!1};const r=e;return{name:typeof r.name=="string"?r.name:"",fields:((a=I([{id:"draft",name:"draft",fields:r.fields??[]}])[0])==null?void 0:a.fields)??[],isPicking:!!r.isPicking}},D="xcalibr_state",u={version:1,isOpen:!1,isWide:!1,isVisible:!0,searchQuery:"",tabOffsetY:0,showMenuBar:!1,isAnchored:!1,menuBarActiveMenu:null,menuBarActiveSubmenu:null,scrapers:[],scraperDraft:{name:"",fields:[],isPicking:!1},scraperBuilderOpen:!1,scraperRunnerOpen:!1,scraperRunnerId:null,scraperRunnerResults:null,scraperRunnerError:null,quickBarToolIds:[],toolWindows:{},toolData:{}},L=e=>{if(!e||typeof e!="object")return{...u};const r=e,a=typeof r.tabOffsetY=="number"?r.tabOffsetY:u.tabOffsetY,b=typeof r.isAnchored=="boolean"?r.isAnchored:u.isAnchored,v=typeof r.menuBarActiveMenu=="string"||r.menuBarActiveMenu===null?r.menuBarActiveMenu:u.menuBarActiveMenu,c=typeof r.menuBarActiveSubmenu=="string"||r.menuBarActiveSubmenu===null?r.menuBarActiveSubmenu:u.menuBarActiveSubmenu,C=I(r.scrapers),B=U(r.scraperDraft),p=typeof r.scraperBuilderOpen=="boolean"?r.scraperBuilderOpen:u.scraperBuilderOpen,t=typeof r.scraperRunnerOpen=="boolean"?r.scraperRunnerOpen:u.scraperRunnerOpen,g=typeof r.scraperRunnerId=="string"||r.scraperRunnerId===null?r.scraperRunnerId:u.scraperRunnerId,h=r.scraperRunnerResults&&typeof r.scraperRunnerResults=="object"?r.scraperRunnerResults:u.scraperRunnerResults,y=typeof r.scraperRunnerError=="string"||r.scraperRunnerError===null?r.scraperRunnerError:u.scraperRunnerError,d=Array.isArray(r.quickBarToolIds)?r.quickBarToolIds.filter(R=>typeof R=="string"):u.quickBarToolIds,f=r.toolWindows&&typeof r.toolWindows=="object"?r.toolWindows:u.toolWindows,T=r.toolData&&typeof r.toolData=="object"?r.toolData:u.toolData;return{...u,...r,tabOffsetY:a,isAnchored:b,menuBarActiveMenu:v,menuBarActiveSubmenu:c,scrapers:C,scraperDraft:B,scraperBuilderOpen:p,scraperRunnerOpen:t,scraperRunnerId:g,scraperRunnerResults:h,scraperRunnerError:y,quickBarToolIds:d,toolWindows:f,toolData:T,version:u.version}},z=async()=>{const e=await chrome.storage.local.get(D);return L(e[D])},Y=async e=>{const r=await z(),a=typeof e=="function"?e(r):{...r,...e},b=L(a);return await chrome.storage.local.set({[D]:b}),b},G=_(()=>{chrome.commands.onCommand.addListener(async e=>{e==="toggle-xcalibr-visibility"&&await Y(r=>({...r,isVisible:!r.isVisible}))}),chrome.runtime.onMessage.addListener((e,r,a)=>{if((e==null?void 0:e.type)==="xcalibr-fetch-robots")return(async()=>{var T;const t=(T=r.tab)==null?void 0:T.id;if(typeof t!="number"){a({error:"No active tab available."});return}const h=(await chrome.tabs.get(t)).url;if(!h){a({error:"Unable to resolve tab URL."});return}const y=new URL(h).origin,f=await(await fetch(`${y}/robots.txt`,{redirect:"follow"})).text();a({url:`${y}/robots.txt`,content:f,updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"Failed to fetch robots.txt."})}),!0;if((e==null?void 0:e.type)==="xcalibr-fetch-headers")return(async()=>{var f;const t=(f=r.tab)==null?void 0:f.id;if(typeof t!="number"){a({error:"No active tab available."});return}const h=(await chrome.tabs.get(t)).url;if(!h){a({error:"Unable to resolve tab URL."});return}const y=await fetch(h,{redirect:"follow"}),d=Array.from(y.headers.entries()).map(([T,R])=>({name:T,value:R}));a({url:h,status:y.status,headers:d,updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"Failed to fetch headers."})}),!0;if((e==null?void 0:e.type)==="xcalibr-payload-replay")return(async()=>{const t=e.payload,g=await fetch(t.url,{method:t.method,headers:Object.fromEntries(t.headers.map(d=>[d.name,d.value])),body:t.method==="GET"||t.method==="HEAD"?void 0:t.body}),h=await g.text(),y=Array.from(g.headers.entries()).map(([d,f])=>({name:d,value:f}));a({responseStatus:g.status,responseHeaders:y,responseBody:h,error:void 0})})().catch(t=>{a({error:t instanceof Error?t.message:"Request failed."})}),!0;if((e==null?void 0:e.type)==="xcalibr-cors-check")return(async()=>{const{url:t}=e.payload,g=await fetch(t,{method:"GET"});a({result:{status:g.status,acao:g.headers.get("access-control-allow-origin"),acc:g.headers.get("access-control-allow-credentials"),methods:g.headers.get("access-control-allow-methods"),headers:g.headers.get("access-control-allow-headers")},updatedAt:Date.now()})})().catch(t=>{a({error:t instanceof Error?t.message:"CORS check failed."})}),!0;if((e==null?void 0:e.type)!=="xcalibr-inject-code")return;const{mode:b,scope:v,code:c}=e.payload,C=async p=>{if(b==="css"){await chrome.scripting.insertCSS({target:{tabId:p},css:c});return}await chrome.scripting.executeScript({target:{tabId:p},func:t=>{const g=document.createElement("script");g.textContent=t,(document.head||document.documentElement).appendChild(g),g.remove()},args:[c]})};return(async()=>{var t;if(v==="current"){const g=(t=r.tab)==null?void 0:t.id;typeof g=="number"&&await C(g),a({ok:!0});return}const p=await chrome.tabs.query({});await Promise.allSettled(p.map(g=>g.id).filter(g=>typeof g=="number").map(g=>C(g))),a({ok:!0})})().catch(()=>a({ok:!1})),!0})});function J(){}var M={exports:{}},V=M.exports,F;function H(){return F||(F=1,(function(e,r){(function(a,b){b(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:V,function(a){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)a.exports=globalThis.browser;else{const b="The message port closed before a response was received.",v=c=>{const C={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(C).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class B extends WeakMap{constructor(n,i=void 0){super(i),this.createItem=n}get(n){return this.has(n)||this.set(n,this.createItem(n)),super.get(n)}}const p=s=>s&&typeof s=="object"&&typeof s.then=="function",t=(s,n)=>(...i)=>{c.runtime.lastError?s.reject(new Error(c.runtime.lastError.message)):n.singleCallbackArg||i.length<=1&&n.singleCallbackArg!==!1?s.resolve(i[0]):s.resolve(i)},g=s=>s==1?"argument":"arguments",h=(s,n)=>function(l,...A){if(A.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${g(n.minArgs)} for ${s}(), got ${A.length}`);if(A.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${g(n.maxArgs)} for ${s}(), got ${A.length}`);return new Promise((x,w)=>{if(n.fallbackToNoCallback)try{l[s](...A,t({resolve:x,reject:w},n))}catch(o){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,o),l[s](...A),n.fallbackToNoCallback=!1,n.noCallback=!0,x()}else n.noCallback?(l[s](...A),x()):l[s](...A,t({resolve:x,reject:w},n))})},y=(s,n,i)=>new Proxy(n,{apply(l,A,x){return i.call(A,s,...x)}});let d=Function.call.bind(Object.prototype.hasOwnProperty);const f=(s,n={},i={})=>{let l=Object.create(null),A={has(w,o){return o in s||o in l},get(w,o,k){if(o in l)return l[o];if(!(o in s))return;let m=s[o];if(typeof m=="function")if(typeof n[o]=="function")m=y(s,s[o],n[o]);else if(d(i,o)){let S=h(o,i[o]);m=y(s,s[o],S)}else m=m.bind(s);else if(typeof m=="object"&&m!==null&&(d(n,o)||d(i,o)))m=f(m,n[o],i[o]);else if(d(i,"*"))m=f(m,n[o],i["*"]);else return Object.defineProperty(l,o,{configurable:!0,enumerable:!0,get(){return s[o]},set(S){s[o]=S}}),m;return l[o]=m,m},set(w,o,k,m){return o in l?l[o]=k:s[o]=k,!0},defineProperty(w,o,k){return Reflect.defineProperty(l,o,k)},deleteProperty(w,o){return Reflect.deleteProperty(l,o)}},x=Object.create(s);return new Proxy(x,A)},T=s=>({addListener(n,i,...l){n.addListener(s.get(i),...l)},hasListener(n,i){return n.hasListener(s.get(i))},removeListener(n,i){n.removeListener(s.get(i))}}),R=new B(s=>typeof s!="function"?s:function(i){const l=f(i,{},{getContent:{minArgs:0,maxArgs:0}});s(l)}),q=new B(s=>typeof s!="function"?s:function(i,l,A){let x=!1,w,o=new Promise(P=>{w=function(E){x=!0,P(E)}}),k;try{k=s(i,l,w)}catch(P){k=Promise.reject(P)}const m=k!==!0&&p(k);if(k!==!0&&!m&&!x)return!1;const S=P=>{P.then(E=>{A(E)},E=>{let j;E&&(E instanceof Error||typeof E.message=="string")?j=E.message:j="An unexpected error occurred",A({__mozWebExtensionPolyfillReject__:!0,message:j})}).catch(E=>{console.error("Failed to send onMessage rejected reply",E)})};return S(m?k:o),!0}),K=({reject:s,resolve:n},i)=>{c.runtime.lastError?c.runtime.lastError.message===b?n():s(new Error(c.runtime.lastError.message)):i&&i.__mozWebExtensionPolyfillReject__?s(new Error(i.message)):n(i)},W=(s,n,i,...l)=>{if(l.length<n.minArgs)throw new Error(`Expected at least ${n.minArgs} ${g(n.minArgs)} for ${s}(), got ${l.length}`);if(l.length>n.maxArgs)throw new Error(`Expected at most ${n.maxArgs} ${g(n.maxArgs)} for ${s}(), got ${l.length}`);return new Promise((A,x)=>{const w=K.bind(null,{resolve:A,reject:x});l.push(w),i.sendMessage(...l)})},Q={devtools:{network:{onRequestFinished:T(R)}},runtime:{onMessage:T(q),onMessageExternal:T(q),sendMessage:W.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:W.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},$={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return C.privacy={network:{"*":$},services:{"*":$},websites:{"*":$}},f(c,Q,C)};a.exports=v(chrome)}})})(M)),M.exports}H();function O(e,...r){}const Z={debug:(...e)=>O(console.debug,...e),log:(...e)=>O(console.log,...e),warn:(...e)=>O(console.warn,...e),error:(...e)=>O(console.error,...e)};let N;try{N=G.main(),N instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw Z.error("The background crashed on startup!"),e}return N})();
background;
